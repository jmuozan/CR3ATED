<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Original with Subdivision Control</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #controls { position: absolute; top: 10px; left: 10px; z-index: 100; }
    canvas { display: block; }
  </style>
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/exporters/STLExporter.js"></script> <!-- STLExporter -->

  <div id="controls">
    <label for="subdivisionsRange">Subdivisions: <span id="subdivisionsValue">12</span></label>
    <input type="range" id="subdivisionsRange" min="3" max="32" step="1" value="12">
    <br>
    <button onclick="exportSTL()">Export .stl</button>
  </div>

  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Original set of points
    const pointsData = [
  {
    "x": 746,
    "y": 165
  },
  {
    "x": 732.5913696289062,
    "y": 186.03660583496094
  },
  {
    "x": 720.5792846679688,
    "y": 207.90045166015625
  },
  {
    "x": 710.0501708984375,
    "y": 230.515625
  },
  {
    "x": 701.0773315429688,
    "y": 253.79197692871094
  },
  {
    "x": 693.7193603515625,
    "y": 277.6280822753906
  },
  {
    "x": 688.01904296875,
    "y": 301.91400146484375
  },
  {
    "x": 684.003662109375,
    "y": 326.53460693359375
  },
  {
    "x": 681.686279296875,
    "y": 351.3727111816406
  },
  {
    "x": 681.0695190429688,
    "y": 376.3110656738281
  },
  {
    "x": 682.1474609375,
    "y": 401.2338562011719
  },
  {
    "x": 684.91015625,
    "y": 426.0264587402344
  },
  {
    "x": 689.347412109375,
    "y": 450.5747375488281
  },
  {
    "x": 695.4522705078125,
    "y": 474.76214599609375
  },
  {
    "x": 703.2247314453125,
    "y": 498.46588134765625
  },
  {
    "x": 712.6752319335938,
    "y": 521.5516357421875
  },
  {
    "x": 723.8282470703125,
    "y": 543.8641357421875
  },
  {
    "x": 736.7247314453125,
    "y": 565.215087890625
  },
  {
    "x": 751.423828125,
    "y": 585.3658447265625
  },
  {
    "x": 768,
    "y": 604
  }
];

    // Convert points to THREE.Vector2
    const points = pointsData.map(p => new THREE.Vector2(p.x, p.y));

    // Initial parameters
    let subdivisions = 12; // Initial number of subdivisions

    // Create the initial lathe geometry and mesh
    let latheGeometry = new THREE.LatheGeometry(points, subdivisions);
    const material = new THREE.MeshBasicMaterial({ color: 0x0077ff, wireframe: true });
    let latheMesh = new THREE.Mesh(latheGeometry, material);
    scene.add(latheMesh);

    camera.position.z = 1500;

    function animate() {
      requestAnimationFrame(animate);
      latheMesh.rotation.y += 0.01;
      renderer.render(scene, camera);
    }
    animate();

    // Adjust scene and camera on window resize
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Function to update the geometry
    function updateGeometry() {
      scene.remove(latheMesh);
      latheGeometry = new THREE.LatheGeometry(points, subdivisions);
      latheMesh = new THREE.Mesh(latheGeometry, material);
      scene.add(latheMesh);
    }

    // Listen to slider changes
    document.getElementById('subdivisionsRange').addEventListener('input', (event) => {
      subdivisions = parseInt(event.target.value);
      document.getElementById('subdivisionsValue').textContent = subdivisions;
      updateGeometry();
    });

    function exportSTL() {
      const exporter = new THREE.STLExporter();
      const stlData = exporter.parse(latheMesh);
      const blob = new Blob([stlData], { type: 'text/plain' });
      const link = document.createElement('a');
      link.style.display = 'none';
      document.body.appendChild(link);
      link.href = URL.createObjectURL(blob);
      link.download = 'latheShape.stl';
      link.click();
    }
  </script>
</body>
</html>